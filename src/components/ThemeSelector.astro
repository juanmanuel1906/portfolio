---
import Moon from "../../public/assets/icons/Moon.astro";
import Sun from "../../public/assets/icons/Sun.astro";
---

<button
    id="theme-toggle"
    class="relative p-2 rounded-full border border-white/10 bg-white/5 hover:scale-110 transition-transform overflow-hidden group"
>
    <div
        class="absolute inset-0 bg-blue-500/20 opacity-0 group-hover:opacity-100 blur-md transition-opacity"
    >
    </div>

    <Sun class="size-5 block dark:hidden" />
    <Moon class="size-5 hidden dark:block" />
</button>

<script is:inline>
    const theme = (() => {
        if (
            typeof localStorage !== "undefined" &&
            localStorage.getItem("theme")
        ) {
            return localStorage.getItem("theme");
        }
        if (window.matchMedia("(prefers-color-scheme: dark)").matches) {
            return "dark";
        }
        return "light";
    })();

    if (theme === "light") {
        document.documentElement.classList.remove("dark");
    } else {
        document.documentElement.classList.add("dark");
    }

    window.localStorage.setItem("theme", theme);

    const handleToggleClick = () => {
        const element = document.documentElement;
        element.classList.toggle("dark");

        const isDark = element.classList.contains("dark");
        localStorage.setItem("theme", isDark ? "dark" : "light");

        updateIconAnimation(isDark);
    };

    document
        .getElementById("theme-toggle")
        .addEventListener("click", handleToggleClick);

    function updateIconAnimation(isDark) {
        import("gsap").then(({ gsap }) => {
            gsap.fromTo(
                "#theme-toggle svg",
                { rotate: 0, scale: 0.5, opacity: 0 },
                {
                    rotate: 360,
                    scale: 1,
                    opacity: 1,
                    duration: 0.5,
                    ease: "back.out(1.7)",
                },
            );
        });
    }
</script>
